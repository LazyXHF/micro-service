<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.mgt.dao.IXietongSysLogDao">

	<resultMap id="BaseResultMap" type="com.project.mgt.entity.TXietongSysLog">
		<!-- column:数据库中表的字段 property：数据库中表所有映射的实体类javaBean中的属性名 -->
		<result column="id" property="id" />
		<result column="isdelete" property="isdelete" />
		<result column="createtime" property="createtime" />
		<result column="exittime" property="exittime" />
		<result column="lasttime" property="lasttime" />
		<result column="request_message" property="requestMessage" />
		<result column="response_message" property="responseMessage" />
		<result column="operator_name" property="operatorName" />
		<result column="operator_id" property="operatorId" />
		<result column="request_url" property="requestUrl" />
		<result column="method_name" property="methodName" />
		<result column="method_info" property="methodInfo" />
	</resultMap>

	<select id="selectCount" resultType="int">
		select count(*) from
		t_xietong_sys_log
		<where>
		<if test="operatorName!=null and operatorName!=''">
			operator_name =#{operatorName}
		</if>
		<if test="startTime!=null and startTime!=''">
			and	createtime >= #{startTime}
		</if>
		<if test="endTime!=null and endTime!=''">
			and createtime <![CDATA[<=]]>#{endTime}
		</if>
	</where>
	</select>

	<!--<select id="selectSyslog" resultMap="BaseResultMap">
		select *
		from (set_lect
		rownum
		as rowno, t.*
		from t_xietong_sys_log t
		where operator_name = #{operatorName}
			and createtime &gt; to_date(#{startTime,jdbcType=VARCHAR},'yyyymmddhh24miss') 
			and createtime &lt; to_date(#{endTime,jdbcType=VARCHAR},'yyyymmddhh24miss') 
			and rownum &lt; (#{pagenum} * #{pagecount})
			order by createtime desc ) table_alias
		where table_alias.rowno &gt; #{rownum}
		//mysql时间转换函数
		DATE_FORMAT(createtime,'%Y-%m-%d') AS startTime,
	</select>-->
	<select id="selectSyslog"   resultMap="BaseResultMap">
		select id,isdelete,createtime,exittime,lasttime,request_message,response_message,operator_name,operator_id,request_url,method_info  from t_xietong_sys_log
		<where>
			<if test="operatorName!=null and operatorName!=''">
				operator_name like  "%"#{operatorName}"%"
			</if>
			<if test="startTime!=null and startTime!=''">
			and	createtime >= #{startTime}
			</if>
			<if test="endTime!=null and endTime!=''">
				and createtime <![CDATA[<=]]>#{endTime}
			</if>
		</where>
		order by createtime desc
		limit #{rownum},#{pagecount} ;
	</select>
	<!--where operator_name =#{operatorName}
	and  createtime>STR_TO_DATE(#{startTime},"%Y-%m-%d")
	and createtime &lt;STR_TO_DATE(#{endTime},"%Y-%m-%d")-->
	<insert id="insertSyslog" parameterType="com.project.mgt.entity.TXietongSysLog">
		insert into
		t_xietong_sys_log(id,isdelete,createtime,exittime,lasttime,request_message,response_message,operator_name,operator_id,request_url,method_name,method_info)
		values(#{id},#{isdelete},#{createtime},#{exittime},#{lasttime},#{requestMessage},#{responseMessage},#{operatorName},#{operatorId},#{requestUrl},#{methodName},#{methodInfo});
	</insert>
	<delete id="del" parameterType="String" >
		delete from t_xietong_sys_log
		where id=#{id}
	</delete>
	<delete id="deleteLogs">
		delete from t_xietong_sys_log where 1=1 order by createtime limit 100;
	</delete>
</mapper>